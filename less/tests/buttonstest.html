<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Buttons &middot; Bootstrap</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">

        <!-- Le styles -->
        <script src="../../js/less-1.3.3.min.js"></script>
        <link href="../../docs/assets/css/bootstrap.css" rel="stylesheet"><link href="../../less/button-groups.less" rel="stylesheet/less"><link href="../../less/buttons.less" rel="stylesheet/less"><link href="../../less/dropdowns.less" rel="stylesheet/less"><link href="../../less/alerts.less" rel="stylesheet/less"><link href="css/jPicker-1.1.6.css" rel="stylesheet"><link href="jPicker.css" rel="stylesheet">
        <style>
            html,body{height: 100%;font-family: "微软雅黑";background-color: #eeeeee;overflow: hidden;}
            .row-fluid{height: 100%;}
            .container{width: 90%;height: 100%;}
            .menuBar{}
            .toolBar {overflow: auto;height: 85%;}
            .canvasBox{overflow: scroll;height:85%;padding: 0;}
            .statusBar{left:auto;right:auto;width: 90%;height: 30px;}
            input[type="file"]{opacity: 0;position: absolute;left: 0;top: 0;height: 25px;}
            .close{font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;}
            #photo{display: none;}
        </style>

        <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <![endif]-->

        <!-- Le fav and touch icons -->
    </head>

    <body>

        <div class="container">

            <div class="btn-toolbar menuBar">
                <div class="btn-group dropdown">
                    <button class="btn">文件</button>
                    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#">打开图片<input type="file" name="file" id="file" size="20"/></a></li>
                        <li><a href="#">新建图层</a></li>
                        <li><a href="#">退出</a></li>
                        <li class="divider"></li>
                        <li><a href="#">保存</a></li>
                    </ul>
                </div><!-- /btn-group -->
                    <div class="btn-group dropdown">
                        <button class="btn">编辑</button>
                        <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                        <ul class="dropdown-menu">
                            <li><a href="#">撤消</a></li>
                            <li><a href="#">恢复</a></li>
                            <li><a href="#">复制</a></li>
                            <li><a href="#">剪切</a></li>
                            <li><a href="#">粘贴</a></li>
                            <li><a href="#">选择</a></li>
                        </ul>
                    </div><!-- /btn-group -->

                <div class="btn-group dropdown filter">
                    <button class="btn filterName">滤镜</button>
                    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#" id="original">原图</a></li>
                        <li><a href="#" id="opposition">底片效果</a></li>
                        <li><a href="#" id="greyScale">黑白效果</a></li>
                        <li><a href="#">二值化</a></li>
                        <li><a href="#">素描效果</a></li>
                    </ul>
                </div><!-- /btn-group -->

            </div><!-- /btn-toolbar -->
            <div class="row-fluid clearfix">
                <div class="span2 toolBar well">toolBar</div>
                <div class="span10 canvasBox well">
                    <canvas id="photo"></canvas>
                </div>
            </div>
            <div class="navbar-fixed-bottom statusBar">
                <div id="colorBox"></div>
                <div class="btn-group dropup">
                    <button class="btn">———————————</button>
                    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#">___________</a></li>
                        <li><a href="#">===========</a></li>
                        <li><a href="#">-----------</a></li>
                        <li><a href="#">……………………………</a></li>
                    </ul>
                </div><!-- /btn-group -->
            </div>
        </div> <!-- /container -->
        <div class="modal fade hide in alert-error" id="myModal">
            <div class="modal-header">
                <a class="close" data-dismiss="modal">×</a>
                <h3>FAIL!</h3>
            </div>
            <div class="modal-body">
                图片太大啦
            </div>
        </div>

        <!-- Le javascript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="../../docs/assets/js/jquery.js"></script><script src="../../docs/assets/js/bootstrap-transition.js"></script><script src="../../docs/assets/js/bootstrap-alert.js"></script><script src="../../docs/assets/js/bootstrap-modal.js"></script><script src="../../docs/assets/js/bootstrap-dropdown.js"></script><script src="../../docs/assets/js/bootstrap-scrollspy.js"></script><script src="../../docs/assets/js/bootstrap-tab.js"></script><script src="../../docs/assets/js/bootstrap-tooltip.js"></script><script src="../../docs/assets/js/bootstrap-popover.js"></script><script src="../../docs/assets/js/bootstrap-button.js"></script><script src="../../docs/assets/js/bootstrap-collapse.js"></script><script src="../../docs/assets/js/bootstrap-carousel.js"></script><script src="../../docs/assets/js/bootstrap-typeahead.js"></script><script src="jpicker-1.1.6.js"></script>
        <script>
            $(document).ready(function(){
                var canvas=$('#photo')[0],dataURL,img;
                <!--改变下拉菜单按钮的值-->
                $('.filter ul li a').click(function(e){
                    e.preventDefault();
                    var $clickedA = $(e.target);
                    var text=$clickedA.text();
                    $(this).closest('.filter').find('.filterName').text(text);
                });<!--end改变下拉菜单按钮的值-->
                <!--调色板-->
                $('#colorBox').jPicker({
                    window:
                    {
                        expandable: true
                    }
                });<!--end调色板-->
                <!--初始化-->
                function initImg(container,dataURL){
                    clear(canvas);
                    $('#photo').hide();
                    if(img){$(img).remove();}
                    img=new Image();
                    img.src=dataURL;
                    $(img).appendTo(container);
                }<!--end初始化-->
                <!--上传图片-->
                $('#file').change(function(){
                    if (window.File && window.FileReader && window.FileList && window.Blob) {
                        var file = this.files[0];
                        var imageType = /image.*/;
                        if (file.type.match(imageType)) {
                            if(file.size >= 512000){
                                $('#myModal .modal-body').text(file.name+"太大啦");
                                $('#myModal').modal({
                                    backdrop:true,
                                    keyboard:true,
                                    show:true
                                });
                            }else{
                                var reader = new FileReader();
                                reader.onload = function(e){
                                    dataURL=e.target.result;
                                    initImg($('.canvasBox'),dataURL);
                                }
                                reader.readAsDataURL(file);
                            }
                        }else{
                            $('#myModal .modal-body').text(file.name+"是图片吗？");
                            $('#myModal').modal({
                                backdrop:true,
                                keyboard:true,
                                show:true
                            });
                        }
                    }
                });<!--end上传图片-->
                <!--恢复原图-->
                $('#original').click(function(e){
                    clear(canvas);
                    $('#photo').hide();
                    e.preventDefault();
                    $(img).show();
                });<!--end恢复原图-->
                <!--反相-->
                function opposition(img){
                    var context=canvas.getContext("2d");
                    context.drawImage(img,0,0);
                    var imageData=context.getImageData(0,0,img.width,img.height);
                    var pixels=imageData.data;
                    var n=pixels.length;
                    for (var i = 0; i < n; i+=4) {
                        var R=pixels[i];
                        var G=pixels[i+1];
                        var B=pixels[i+2];
                        var alpha=pixels[i+3];

                        pixels[i]=255-R;
                        pixels[i+1]=255-G;
                        pixels[i+2]=255-B;
                    };
                    imageData.data=pixels;
                    $(img).hide();
                    return imageData;
                }
                $('#opposition').click(function(e){
                    e.preventDefault();
                    displayImg(canvas,opposition(img));

                });<!--end反相-->
                <!--灰度图-->
                function greyScale(img){
                    var context=canvas.getContext("2d");
                    context.drawImage(img,0,0);
                    var imageData=context.getImageData(0,0,img.width,img.height);
                    var pixels=imageData.data;
                    var n=pixels.length;
                    for (var i = 0; i < n; i+=4) {
                        var R=pixels[i];
                        var G=pixels[i+1];
                        var B=pixels[i+2];
                        var alpha=pixels[i+3];


                        var gray=parseInt((R+G+B)/3);
                        pixels[i+1]=pixels[i+2]=pixels[i]=gray;
                    };
                    imageData.data=pixels;
                    $(img).hide();
                    return imageData;
                }
                $('#greyScale').click(function(e){
                    e.preventDefault();
                    displayImg(canvas,greyScale(img));
                });<!--end灰度图-->
                <!--均值-->
                function average(array){
                    return sum(array)/array.length;
                }<!--end均值-->
                <!--求和-->
                function sum(array){
                    var sum=0;
                    for(var i in array){
                        sum+=Number(array[i]);
                    }
                    return sum;
                }<!--end求和-->
                <!--清除画布-->
                function clear(canvas){
                    var context=canvas.getContext("2d");
                    context.clearRect(0,0,canvas.width,canvas.height);
                }<!--end清除画布-->
                <!--处理图像后展示-->
                function displayImg(canvas,imageData){
                    var context=canvas.getContext("2d");
                    canvas.width=img.width;
                    canvas.height=img.height;
                    context.putImageData(imageData,0,0);
                    $('#photo').show();
                }<!--end处理图像后展示-->
            });
        </script>
    </body>
</html>
